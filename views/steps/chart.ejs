<%- include('../partials/header') %>
<div class="container mt-5">
  <div class="row mb-4">
    <div class="col-md-8">
      <h2>üìä Grafikon</h2>
      <p class="lead text-muted">Utols√≥ <strong><%= period || 30 %></strong> nap</p>
    </div>
    <div class="col-md-4 text-end">
      <div class="btn-group" role="group">
        <a href="/steps/chart/view?period=7" class="btn btn-outline-primary btn-sm">7 nap</a>
        <a href="/steps/chart/view?period=30" class="btn btn-outline-primary btn-sm">30 nap</a>
        <a href="/steps/chart/view?period=365" class="btn btn-outline-primary btn-sm">1 √©v</a>
      </div>
    </div>
  </div>
  <div class="card shadow-lg" style="background: linear-gradient(135deg, rgba(45, 45, 68, 0.8), rgba(58, 58, 82, 0.8)); border: 1px solid rgba(0, 212, 255, 0.2);">
    <div class="card-body" style="padding: 2rem;">
      <div id="chartAlert" class="mb-3"></div>
      <canvas id="stepsChart"></canvas>
    </div>
  </div>
  <div class="mt-4 text-center">
    <a href="/steps" class="btn btn-outline-secondary">üîô Vissza a list√°hoz</a>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  try {
    const data = <%- JSON.stringify(data) %> || [];
    if (!Array.isArray(data) || data.length === 0) {
      document.getElementById('chartAlert').innerHTML = '<div class="alert alert-info text-center"><h5>üì≠ Nincs adat az id≈ëszakban</h5><p>Adj hozz√° n√©h√°ny bejegyz√©st az adatok megjelen√≠t√©s√©hez.</p></div>';
    } else {
      const labels = data.map(d => {
        const dt = new Date(d.date);
        const y = dt.getFullYear();
        const m = String(dt.getMonth() + 1).padStart(2, '0');
        const day = String(dt.getDate()).padStart(2, '0');
        return `${y}-${m}-${day}`;
      });
      const values = data.map(d => Number(d.steps) || 0);
      const ctx = document.getElementById('stepsChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'L√©p√©sek',
            data: values,
            borderColor: '#00d4ff',
            backgroundColor: 'rgba(0, 212, 255, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: '#00d4ff',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 5,
            pointHoverRadius: 7
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              labels: {
                color: '#ddd',
                font: { size: 12, weight: '600' }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: 'rgba(0, 212, 255, 0.1)', drawBorder: false },
              ticks: { color: '#00d4ff', font: { size: 11 } }
            },
            x: {
              grid: { color: 'rgba(0, 212, 255, 0.1)', drawBorder: false },
              ticks: { color: '#999', font: { size: 11 } }
            }
          }
        }
      });
    }
  } catch (err) {
    console.error('Chart render error:', err);
    document.getElementById('chartAlert').innerHTML = '<div class="alert alert-danger text-center"><h5>‚ö†Ô∏è Hiba a grafikon megjelen√≠t√©sekor</h5></div>';
  }
</script>

<%- include('../partials/footer') %>